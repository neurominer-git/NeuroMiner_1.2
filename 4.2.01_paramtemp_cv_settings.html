

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cross-validation settings &#8212; NeuroMiner Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1F3TPH8HH8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-1F3TPH8HH8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4.2.01_paramtemp_cv_settings';</script>
    <link rel="canonical" href="https://neurominer-git.github.io/NeuroMiner_1.2/4.2.01_paramtemp_cv_settings.html" />
    <link rel="shortcut icon" href="_static/nm_logo2.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Preprocessing pipeline" href="4.2.02_paramtemp_preprocessing_pipeline.html" />
    <link rel="prev" title="Data Fusion" href="4.2.00_paramtemp_data_fusion.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/nm_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/nm_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    NeuroMiner
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">News</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="5.00_1.2_release_notes.html">NeuroMiner 1.2 (09/2023)</a></li>
<li class="toctree-l1"><a class="reference internal" href="0.1_2024_MLSchool.html">Online Machine Learning School 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="0.1_2023_MLSchool.html">Online Machine Learning School 2023 - Europe</a></li>
<li class="toctree-l1"><a class="reference internal" href="0.1_2023_MLSchool_AsiaPacific.html">Online Machine Learning School 2023 - Asia-Pacific</a></li>
<li class="toctree-l1"><a class="reference internal" href="0.0_previous_MLSchool.html">Past Schools</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="1.0_introduction.html">Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="license.html">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2.0_prerequisites.html">Suggested Prerequisites</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="3.0_gettingstarted.html">Installation &amp; Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="3.0.00_macos_users.html">Setting up NeuroMiner on macOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.0.01_python_matlab.html">How to configure Python with Matlab for NeuroMiner on the server</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NeuroMiner interface</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4.0_mainmenu.html">Main interface overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.1_mainmenu_input_data.html">Data entry in NeuroMiner</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="4.2_mainmenu_define_parameter_template.html">Define parameter template</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="4.2.00_paramtemp_data_fusion.html">Data Fusion</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Cross-validation settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.02_paramtemp_preprocessing_pipeline.html">Preprocessing pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.03_paramtemp_classification_algorithm.html">Classification algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.04_paramtemp_learning_algorithm_parameters.html">Learning algorithm parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.05_paramtemp_ensemble_generation_strategies.html">Ensemble generation strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.06_paramtemp_visualization_options.html">Visualization options</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.07_paramtemp_interpretation_options.html">Prediction interpretation options</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.08_paramtemp_model_saving_options.html">Model saving options</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.09_paramtemp_define_verbosity_level.html">Define verbosity level</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.10_paramtemp_inspect_workspace.html">Inspect workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.11_paramtemp_save_parameter_template.html">Save parameter template</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.12_paramtemp_load_training_template.html">Load training template</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.13_paramtemp_multigroup.html">Multi-group analyses</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.14_paramtemp_stacking.html">Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.15_paramtemp_different_label.html">Use different label</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2.16_paramtemp_synthetic_data.html">Synthetic data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4.3_mainmenu_initialize_delete_analyses.html">Initialize analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.4_mainmenu_preprocess_features.html">Preprocess features</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.5_mainmenu_train_supervised_classifiers.html">Train supervised classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.6_mainmenu_visualize_classifiers.html">Visualize classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.14_mainmenu_interprete_classifiers.html">Interprete predictions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="4.7_mainmenu_display_training_results.html">Result Viewer</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="4.7.01_mainmenu_display_visualization_results.html">Visualization results</a></li>

<li class="toctree-l2"><a class="reference internal" href="4.7.02_mainmenu_display_interpretation_results.html">ML Interpreter (MLI) results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4.8_mainmenu_OOCV_analysis.html">Out of Sample Cross-Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.15_mainmenu_export_model.html">Export model parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.9_mainmenu_load_struct.html">Load NeuroMiner structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.10_mainmenu_save_struct.html">Save NeuroMiner structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.11_mainmenu_change_wd.html">Change working directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.12_mainmenu_estimate_sample_size.html">Estimate sample size (simulation tool)</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.13_mainmenu_utilities.html">Utilities</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Parallelization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="5.01_NM_compilation.html">Parallelization on HPC server - NeuroMiner compilation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/neurominer-git/NeuroMiner_1.2" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/neurominer-git/NeuroMiner_1.2/issues/new?title=Issue%20on%20page%20%2F4.2.01_paramtemp_cv_settings.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4.2.01_paramtemp_cv_settings.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cross-validation settings</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select-cross-validation-framework">Select cross-validation framework</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nested-cross-validation-in-neurominer">Nested cross-validation in NeuroMiner</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-cross-valiation">Repeated cross-valiation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-number-of-folds-permutations-in-cv1-cv2">Define the number of folds &amp; permutations in CV1 &amp; CV2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-number-of-permutations">Choosing the number of permutations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-number-of-folds">Choosing the number of folds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equalize-class-sizes-at-the-cv1-cycle-by-undersampling">Equalize class sizes at the CV1 cycle by undersampling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiclass-classification-setting-define-decomposition-mode">Multiclass classification setting: Define decomposition mode</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constrain-cross-validation-structure-based-on-a-group-index-variable">Constrain Cross-Validation structure based on a group index variable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-load-save-the-cross-validation-structure">Build, load &amp; save the cross-validation structure</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="cross-validation-settings">
<span id="paramtemp-cv-settings"></span><h1>Cross-validation settings<a class="headerlink" href="#cross-validation-settings" title="Permalink to this heading">#</a></h1>
<p>Cross-validation is a fundamental core of machine learning analysis
because it facilitates out-of-sample generalization and parameter tuning
(see <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)">wiki</a>.
NeuroMiner has been built to flexibly create custom cross-validation
schemes depending on your data problem. NeuroMiner has been built around
performing repeated, nested cross-validation, which is a very robust
method that increases the likelihood of generalization.</p>
<p>The cross-validation works by first defining the following settings:</p>
<div class="figure align-default" id="fig-nm-paramtemp-cv-init">
<img alt="neurominer_cv_settings" src="_images/NM_paramtemp_cv_init.png" />
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">NeuroMiner cross-validation framework setup</span><a class="headerlink" href="#fig-nm-paramtemp-cv-init" title="Permalink to this image">#</a></p>
</div>
<hr class="docutils" />
<div class="section" id="select-cross-validation-framework">
<span id="cv-framework"></span><h2>Select cross-validation framework<a class="headerlink" href="#select-cross-validation-framework" title="Permalink to this heading">#</a></h2>
<p>This option allows the user to select either k-fold cross-validation
scheme (including leave-one-out) or a leave-group-out analysis with the
following options:</p>
<div class="figure align-default" id="fig-3-2-01-cv-types">
<img alt="neurominer_cv_types" src="_images/NM_paramtemp_cvtypes.png" />
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">NeuroMiner cross-validation frameworks</span><a class="headerlink" href="#fig-3-2-01-cv-types" title="Permalink to this image">#</a></p>
</div>
<p>NeuroMiner has been built around the gold standard of repeated, nested cross-validation <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)">(Filzmoser et al.,
2009)</a> and therefore the default options are reflective of this. For a description of cross-validation, you could check-out the supplementary material of this publication: <a class="reference external" href="http://thelancet.com/journals/lanpsy/article/PIIS2215-0366(16)30171-7/fulltext">Koutsouleris et al.,
2016</a>.
In brief, leave-one-out cross-validation and k-fold cross-validation risk overfitting (i.e., your models not generalizing past your sample) in the context of (hyper)parameter optimisation (e.g., optimizing C parameters) or the optimization of feature selection based on the predictive accuracy on the held-out dataset (e.g., using filters or wrappers discussed in <a class="reference internal" href="4.2.05_paramtemp_ensemble_generation_strategies.html#ensemble-generation-strategies"><span class="std std-ref">Ensemble generation strategies</span></a>). Nested cross-validation mitigates against overfitting and provides models that are more likely to generalize – which is the central aim of machine learning and science generally.</p>
<div class="section" id="nested-cross-validation-in-neurominer">
<h3>Nested cross-validation in NeuroMiner<a class="headerlink" href="#nested-cross-validation-in-neurominer" title="Permalink to this heading">#</a></h3>
<div class="figure align-default" id="fig-3-2-01-nested-cv">
<img alt="neurominer nested cross-validation" src="_images/nested_cv.png" />
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Nested cross-validation</span><a class="headerlink" href="#fig-3-2-01-nested-cv" title="Permalink to this image">#</a></p>
</div>
<p>A depiction of nested cross-validation is represented in <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 9</span></a>. In NeuroMiner the outer cross-validation cycle of a nested cross-validation scheme is designated as <strong>CV2</strong> and the inner cross-validation folds are designated as <strong>CV1</strong>. Models are trained in the CV1 cycle and then the best performing models are applied to the CV2 data. This separation of CV2 and CV1 data avoids overfitting.</p>
<p>First the data is split into <em>k_outer</em> folds in the outer CV2 set. One of these CV2 folds is held out and serves as the test set in this round. The rest of the data goes into the ’nest’ where it is again subdivided into <em>k_inner</em> folds (note: <em>k_inner</em> does not have to be = to <em>k_outer</em>). In the ‘nest’, an inner test-fold is held out, and the rest of the data is used for training. Models associated with each parameter combination are created in the CV1 (inner) training data and applied to the CV1 test data (as shown in <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 9</span></a>, <strong>A</strong>). The accuracy is assessed across all parameter combinations for all CV1 models. The optimal parameter combination is chosen based on a criteria set by the user. For each CV1 fold, a model is retrained on the processed training and test data with the winning parameter or parameter combination. The models are then applied to the held-out CV2 test data (as shown in <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 9</span></a>, <strong>B</strong>).</p>
<p>In cases where there are many (hyper)parameter combinations or when a variable selection procedure is employed, then the user can choose to keep a percentage of top performing models for each fold, instead of only the single optimum model. This is further discussed in <a class="reference internal" href="4.2.04_paramtemp_learning_algorithm_parameters.html#learning-algorithm-parameters"><span class="std std-ref">Learning algorithm parameters</span></a>.</p>
<p>Let’s look at the other cross-validation frameworks included in NeuroMiner:</p>
<div class="admonition-cross-validation-frameworks-in-neurominer admonition">
<p class="admonition-title">Cross-validation frameworks in NeuroMiner</p>
<p><strong>1 | Pooled</strong>
Outer and inner cross-validation folds will be automatically and randomly defined.</p>
<p><strong>2 | Outer Leave-Group Out/Inner pooled</strong>
The outer CV2 folds will be defined by the user using a vector defining groups (e.g., if there are different sites then this will test the ability of the classifiers that are trained with pooled site data to generalise to new sites).</p>
<p><strong>3 | Nested Leave-Group-Out</strong>
Both the outer and inner cycles will be separated based on the grouping vector that the user enters (e.g., in the site example, this will mean that the models will be optimised to generalise across sites in the CV1 cycle and then applied to different sites in the CV2 cycle).</p>
<p><strong>4 | Outer Leave-Group-Out/Inner Leave-Group-In</strong>
The models in the inner CV1 cycle will only be trained in one group prior to being applied to all other groups (e.g., this will test the robustness of models from single sites). See <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 9</span></a> for more details and imagine that the folds are sites or diagnoses or any other grouping variable.</p>
</div>
</div>
<div class="section" id="repeated-cross-valiation">
<h3>Repeated cross-valiation<a class="headerlink" href="#repeated-cross-valiation" title="Permalink to this heading">#</a></h3>
<p>To further avoid overfitting and increase the generalizability of the model predictions, NeuroMiner also allows the user to implement ’repeated’ cross-validation for each of the CV cycles. This involves shuffling the subjects prior to the definition of the folds so that there are different subjects in the test/training folds. This is usually done for both the CV2 and CV1 cycles.</p>
<p>A clear depiction of how repeated cross-validation works is difficult, but it is important to keep in mind that there will be a lot of models produced under these schemes; e.g., if you have a standard 10x10 CV1/CV2 framework and you’re choosing the optimal model for each fold, then you’ll have 10,000 models. A way to understand how these are applied to an individual subject is to consider that all models in which that subject is not included in the CV1 training/testing are applied to them – because if they were included then this would be information leakage. On the surface, having 10,000 models is not so great for the interpretation or understanding of a phenomenon under investigation. However, doing this can be really good for generalization when it’s unlikely that there is a singular model that can be found and we need something that works in practice – e.g., for many complex problems in psychiatry. For an interesting discussion on this topic, see <a class="reference external" href="http://www.stat.uchicago.edu/~lekheng/courses/191f09/breiman.pdf">Breiman et al., 2001</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Repetition is only available for some cross-validation frameworks (when it makes sense).</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="define-the-number-of-folds-permutations-in-cv1-cv2">
<h3>Define the number of folds &amp; permutations in CV1 &amp; CV2<a class="headerlink" href="#define-the-number-of-folds-permutations-in-cv1-cv2" title="Permalink to this heading">#</a></h3>
<p>In the cross-validation menu (<a class="reference internal" href="#fig-nm-paramtemp-cv-init"><span class="std std-numref">Fig. 7</span></a>) you can define the number of permutations (“repeats”) and folds for CV1 and CV2 respectively using the options 2 to 5 (note that these might change depending on the cross-validation framework you choose!).</p>
<div class="section" id="choosing-the-number-of-permutations">
<h4>Choosing the number of permutations<a class="headerlink" href="#choosing-the-number-of-permutations" title="Permalink to this heading">#</a></h4>
<p>For some cross-validation frameworks, you can define the number of repetitions that you of the cross-validaiton procedure. If you choose to use repeated cross-validation, the subjects are shuffled and new folds are created. To choose the number of permutations, try to find a balance between the computational time that your analysis is taking and the stability of the predictions from your modeling.</p>
</div>
</div>
<div class="section" id="choosing-the-number-of-folds">
<h3>Choosing the number of folds<a class="headerlink" href="#choosing-the-number-of-folds" title="Permalink to this heading">#</a></h3>
<p>The number of folds is usually based on the number of subjects you have and what kind of analyses you want to compute.</p>
<p>For an analytic example of when the number of CV1 folds is crucial for the outcome see the section on <a class="reference internal" href="4.2.05_paramtemp_ensemble_generation_strategies.html#ensemble-generation-strategies"><span class="std std-ref">Ensemble generation strategies</span></a> – e.g., when using wrappers that are optimizing features based on the subjects in the CV1 test folds.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you enter “-1” as the number of CV1 or CV2 folds, then NeuroMiner implements a <strong>leave-one-out cross-validation</strong> and the permutations option is not possible (because it doesn’t matter if you shuffle the data if every single subject is left out). The number of CV folds is usually based on the number of subjects that you have.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="equalize-class-sizes-at-the-cv1-cycle-by-undersampling">
<h3>Equalize class sizes at the CV1 cycle by undersampling<a class="headerlink" href="#equalize-class-sizes-at-the-cv1-cycle-by-undersampling" title="Permalink to this heading">#</a></h3>
<p>Unbalanced group sizes (e.g., less people transitioning to illness than people who do not) pose a problem for many machine learning techniques. Usually, the trained model shows a bias towards the majority group and you’ll get unbalanced predictions (e.g., your specificity will be high, but sensitivity low).</p>
<p>In NeuroMiner there are three ways to deal with this:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Undersampling the majority group during training</p></li>
<li><p>Weighting of hyperplanes in case of margin-based classifiers (SVM as implemented in <a class="reference external" href="https://www.csie.ntu.edu.tw/~cjlin/libsvm/">LIBSVM</a> or <a class="reference external" href="https://www.csie.ntu.edu.tw/~cjlin/liblinear/#download">LIBLINEAR</a>)</p></li>
<li><p>Oversampling using “Adaptive synthetic sampling” (ADASYN, see <a class="reference external" href="https://ieeexplore.ieee.org/document/4633969">He et al., 2008</a>) which is recommended for all other algorithms in NM</p></li>
</ol>
</div></blockquote>
<p>In the classification setting, option 1 allows the user to undersample the majority group so that the groups are balanced when the models are created in the CV1 folds. In the case of the regression framework, undersampling aims at creating a uniform distribution of the target label(s).</p>
<p>After selecting the undersampling option (for classification, it’s called “Equalize class sizes at the CV1 cycle by undersampling”; for regression, it’s “Equalize label histogram at the CV1 cycle by undersampling“), new settings will be added to your menu:</p>
<p>In the case of classification, selecting the menu will now include:</p>
<blockquote>
<div><p>Define positive/negative ratio after equalization (1=&gt;same amount of positive/negative cases) [ 1.5 ]</p>
<p>Shuffle removed observations to CV1 test data [ yes ]</p>
</div></blockquote>
<p>The <em>target ratio</em> is the ratio of the bigger to smaller class sample sizes. Equal class sizes can be selected by entering in ”1”. The default is 1.5 because otherwise the models may not generalize well.</p>
<p>The menu entry “Shuffle removed observations to CV1 test data” gives the user the option to add the excluded CV1 subjects in the training folds to the CV1 test folds, e.g.  for identifying optimal hyperparameters for model generalization.</p>
<p>In the case of regression, the menu will now include:</p>
<blockquote>
<div><p>1 | Define target label(s) for uniform distribution</p>
<p>2 | Define minimum # of observations at the lower end of label histogram</p>
<p>3 | Define minimum # of observations at the upper end of label histogram</p>
<p>4 | Define # of bins in label histogram</p>
<p>5 | Show original histogram of the entire data</p>
<p>6 | Show (equalized) histogram of CV1 training partition [1,1] (build CV structure first!)</p>
</div></blockquote>
<p><strong>7 | Define positive/negative ratio after equalization (1=&gt;same amount of positive/negative cases)</strong>: This is the ratio of the bigger to smaller class sample sizes. Equal class sizes can be selected by entering in ”1”. The default is “1.5” because otherwise the models may not generalize well.</p>
<!-- If the dataset has any covariates, selecting ”Covariate” option will require you to select the covariates (integers or range). -->
<p><strong>8 | Shuffle removed observations to CV1 test data</strong>: The next option gives the user the option to add the excluded CV1 subjects in the training folds to the CV1 test folds. This option is can be important to judge generalizability of the models to the CV2 folds (and ultimately to real-life).</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="multiclass-classification-setting-define-decomposition-mode">
<h2>Multiclass classification setting: Define decomposition mode<a class="headerlink" href="#multiclass-classification-setting-define-decomposition-mode" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>1 | One-vs-One</p>
<p>2 | One-vs-All</p>
</div></blockquote>
<p>This option only shows in case your label is a multiclass classification label. You have to define the decomposition mode you want to use.</p>
<p><strong>One vs. One</strong> means that pairwise classification models will be fit between all possible group pairs. If you have a label containing three groups, the following binary three models will be trained: group 1 vs. 2, group 1 vs. 3, group 2 vs. 3.</p>
<p><strong>One vs. All</strong> means that for each of the groups in your label, a model will be fit to classify this group from all other groups. If you have a label containing three groups, the following models will be trained: group 1 vs. (2+3), 2 vs. (1+3), 3 vs. (1+2).</p>
</div>
<div class="section" id="constrain-cross-validation-structure-based-on-a-group-index-variable">
<h2>Constrain Cross-Validation structure based on a group index variable<a class="headerlink" href="#constrain-cross-validation-structure-based-on-a-group-index-variable" title="Permalink to this heading">#</a></h2>
<p>You can enter a vector defining groups which will be used additionally to the label to stratify the cross validation folds, i.e., the function will make sure to distribute the groups equally across folds.</p>
</div>
<div class="section" id="build-load-save-the-cross-validation-structure">
<h2>Build, load &amp; save the cross-validation structure<a class="headerlink" href="#build-load-save-the-cross-validation-structure" title="Permalink to this heading">#</a></h2>
<p><strong>Build CV2/CV1 structure</strong>
Once the options above have been set, the user needs to build the CV2/CV1 structure. This literally creates all the folds and indexes the subjects that are to be included in the folds. These can be found in the NM structure (i.e., in “<a class="reference external" href="http://NM.cv">NM.cv</a>”).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The user must select <strong>Build the cross-validation structure</strong> before
exiting the cross-validation menu. Otherwise, the cross-validation framework will not be saved
within the NM structure.</p>
</div>
<p><strong>Load CV structure</strong>
If you have saved the CV structure for your data with the subjects indexed into each fold/permutation, you can load it using this function. This can be useful if you establish a new analysis with new settings, but you want to load the CV structure that you created before.</p>
<p><strong>Save CV structure</strong>
This gives the user the option to save the indexed CV structure
containing the folds and permutations for later use. It is saved in a .mat file.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="4.2.00_paramtemp_data_fusion.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Data Fusion</p>
      </div>
    </a>
    <a class="right-next"
       href="4.2.02_paramtemp_preprocessing_pipeline.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Preprocessing pipeline</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select-cross-validation-framework">Select cross-validation framework</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nested-cross-validation-in-neurominer">Nested cross-validation in NeuroMiner</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-cross-valiation">Repeated cross-valiation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-number-of-folds-permutations-in-cv1-cv2">Define the number of folds &amp; permutations in CV1 &amp; CV2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-number-of-permutations">Choosing the number of permutations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-number-of-folds">Choosing the number of folds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equalize-class-sizes-at-the-cv1-cycle-by-undersampling">Equalize class sizes at the CV1 cycle by undersampling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiclass-classification-setting-define-decomposition-mode">Multiclass classification setting: Define decomposition mode</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constrain-cross-validation-structure-based-on-a-group-index-variable">Constrain Cross-Validation structure based on a group index variable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-load-save-the-cross-validation-structure">Build, load &amp; save the cross-validation structure</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By <a href="https://www.lmu-klinikum.de/psychiatrie-und-psychotherapie/forschung-research/working-groups/precision-psychiatry/7ef67d79b4ad4804">Section for Precision Psychiatry, Ludwig-Maximilian-University Munich</a> / <a href="https://www.psych.mpg.de/2571270/precision-psychiatry">Precision Psychiatry Group, Max Planck Institute of Psychiatry</a>
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>