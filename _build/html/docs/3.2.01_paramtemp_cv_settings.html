
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Cross-validation settings &#8212; NeuroMiner Manual</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Preprocessing pipeline" href="3.2.02_paramtemp_preprocessing_pipeline.html" />
    <link rel="prev" title="Data Fusion" href="3.2.00_paramtemp_data_fusion.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/nm_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NeuroMiner Manual</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    <no title>
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1.0_introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1.1_prerequisites.html">
   Suggested Prerequisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1.2_gettingstarted.html">
   Getting Started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NeuroMiner interface
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="3.0_mainmenu.html">
   Main interface overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.1_mainmenu_input_data.html">
   Data entry in NeuroMiner
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="3.2_mainmenu_define_parameter_template.html">
   Define parameter template
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.00_paramtemp_data_fusion.html">
     Data Fusion
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Cross-validation settings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.02_paramtemp_preprocessing_pipeline.html">
     Preprocessing pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.03_paramtemp_classification_algorithm.html">
     Classification algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.04_paramtemp_learning_algorithm_parameters.html">
     Learning algorithm parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.05_paramtemp_ensemble_generation_strategies.html">
     Ensemble generation strategies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.06_paramtemp_visualization_options.html">
     Visualization options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.07_paramtemp_model_saving_options.html">
     Model saving options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.08_paramtemp_save_parameter_template.html">
     Save parameter template
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.09_paramtemp_load_training_template.html">
     Load training template
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.10_paramtemp_define_verbosity_level.html">
     Define verbosity level
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3.2.11_paramtemp_stacking.html">
     Stacking
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.3_mainmenu_initialize_delete_analyses.html">
   Initialize analyses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.4_mainmenu_preprocess_features.html">
   Preprocess features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.5_mainmenu_train_supervised_classifiers.html">
   Train supervised classifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.6_mainmenu_visualize_classifiers.html">
   Visualize classifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.7_mainmenu_display_training_results.html">
   Display training results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.8_mainmenu_generate_master_files.html">
   Generate master files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3.9_mainmenu_OOCV_analysis.html">
   Out of Sample Cross-Validation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="4.0_Example.html">
   Example
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Functions in development
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="3.10_mainmenu_investigate_sample_size.html">
   Investigate sample size (simulation)
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdocs/3.2.01_paramtemp_cv_settings.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docs/3.2.01_paramtemp_cv_settings.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neurominer-cross-validation-framework-setup">
   NeuroMiner cross-validation framework setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#select-cross-validation-framework">
   Select cross-validation framework
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nested-cross-validation-in-neurominer">
     Nested cross-validation in NeuroMiner
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#repeated-cross-valiation">
     Repeated cross-valiation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-number-pf-folds-permutations-in-cv1-cv2">
     Define the number pf folds &amp; permutations in CV1 &amp; CV2
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choosing-the-number-of-permutations">
       Choosing the number of permutations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choosing-the-number-of-folds">
     Choosing the number of folds
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equalize-class-sizes-at-the-cv1-cycle-by-undersampling">
     Equalize class sizes at the CV1 cycle by undersampling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-load-save-the-cross-validation-structure">
   Build, load &amp; save the cross-validation structure
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Cross-validation settings</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neurominer-cross-validation-framework-setup">
   NeuroMiner cross-validation framework setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#select-cross-validation-framework">
   Select cross-validation framework
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nested-cross-validation-in-neurominer">
     Nested cross-validation in NeuroMiner
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#repeated-cross-valiation">
     Repeated cross-valiation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-number-pf-folds-permutations-in-cv1-cv2">
     Define the number pf folds &amp; permutations in CV1 &amp; CV2
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choosing-the-number-of-permutations">
       Choosing the number of permutations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choosing-the-number-of-folds">
     Choosing the number of folds
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equalize-class-sizes-at-the-cv1-cycle-by-undersampling">
     Equalize class sizes at the CV1 cycle by undersampling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-load-save-the-cross-validation-structure">
   Build, load &amp; save the cross-validation structure
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="cross-validation-settings">
<span id="paramtemp-cv-settings"></span><h1>Cross-validation settings<a class="headerlink" href="#cross-validation-settings" title="Permalink to this headline">#</a></h1>
<p>Cross-validation is a fundamental core of machine learning analysis
because it facilitates out-of-sample generalization and parameter tuning
(see <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)">wiki</a>.
NeuroMiner has been built to flexibly create custom cross-validation
schemes depending on your data problem. NeuroMiner has been built around
performing repeated, nested, cross-validation, which is a very robust
method that increases the likelihood of generalization.</p>
<p>The cross-validation works by first defining the following settings:</p>
<figure class="align-default" id="fig-3-2-01-cv-menu">
<img alt="neurominer_cv_settings" src="../_images/NM_paramtemp_cv_init.png" />
</figure>
<section id="neurominer-cross-validation-framework-setup">
<h2>NeuroMiner cross-validation framework setup<a class="headerlink" href="#neurominer-cross-validation-framework-setup" title="Permalink to this headline">#</a></h2>
</section>
<section id="select-cross-validation-framework">
<span id="cv-framework"></span><h2>Select cross-validation framework<a class="headerlink" href="#select-cross-validation-framework" title="Permalink to this headline">#</a></h2>
<p>This option allows the user to select either k-fold cross-validation
scheme (including leave-one-out) or a leave-group-out analysis with the
following options:</p>
<figure class="align-default" id="fig-3-2-01-cv-types">
<img alt="neurominer_cv_types" src="../_images/NM_paramtemp_cvtypes.png" />
</figure>
<p>NeuroMiner has been built around the gold standard of repeated, nested cross-validation <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)">(Filzmoser et al.,
2009)</a> and therefore the default options are reflective of this. For a description of cross-validation, you could check-out the supplementary material of this publication: <a class="reference external" href="http://thelancet.com/journals/lanpsy/article/PIIS2215-0366(16)30171-7/fulltext">Koutsouleris et al.,
2016</a>.
In brief, leave-one-out cross-validation and k-fold cross-validation risk overfitting (i.e., your models not generalizing past your sample) in the context of (hyper)parameter optimisation (e.g., optimizing C parameters) or the optimization of feature selection based on the predictive accuracy on the held-out dataset (e.g., using wrappers discussed in [ensemble learning]{3.2.05_paramtemp_ensemble_generation_strategies}). Nested cross-validation mitigates against overfitting and provides models that are more likely to generalize – which is the central aim of machine learning and science generally.</p>
<section id="nested-cross-validation-in-neurominer">
<h3>Nested cross-validation in NeuroMiner<a class="headerlink" href="#nested-cross-validation-in-neurominer" title="Permalink to this headline">#</a></h3>
<figure class="align-default" id="fig-3-2-01-nested-cv">
<img alt="neurominer nested cross validation" src="../_images/nested_cv.png" />
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Nested cross validation</span><a class="headerlink" href="#fig-3-2-01-nested-cv" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A depiction of nested cross-validation is represented in <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 8</span></a>. In NeuroMiner the outer cross-validation cycle of a nested cross-validation scheme is designated as <strong>CV2</strong> and the inner cross-validation folds are designated as <strong>CV1</strong>. Models are trained in the CV1 cycle and then the best performing models are applied to the CV2 data. This separation of CV2 and CV1 data avoids overfitting.</p>
<p>First the data is split into k number of folds in the outer CV2 set and a CV2 test set is held-out. The rest of the data goes into the ’nest’ where it is again subdivided into k-folds, a test fold is held-out, and the rest of the data is used for training. Models associated with each parameter combination (e.g., C or epsilon) are created in the CV1 training data and applied to the CV1 test data (as shown in <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 8</span></a>, <strong>A</strong>). The accuracy is assessed across all parameter combinations for all CV1 models. The optimal parameter combination is chosen based on a criteria set by the user. For each CV1 fold, the training and test data, which has been preprocessed, is retrained with the winning parameter or parameter combination. The models are then applied to the held-out CV2 test data (as shown in <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 8</span></a>, <strong>B</strong>).</p>
<p>In cases where there are many (hyper)parameter combinations or when a variable selection procedure is employed, then the user can choose to keep a percentage of top performing models for each fold, instead of only the single optimum model. This is further discussed in [learning algorithm parameters]{3.2.04_paramtemp_learning_algorithm_parameters}.</p>
<p>Let’s look at the other cross-validation frameworks included in NeuroMiner:</p>
<div class="admonition-cross-validation-frameworks-in-neurominer admonition">
<p class="admonition-title">Cross-validation frameworks in NeuroMiner</p>
<p><strong>1 | Pooled</strong>
Outer and inner cross-validation folds will be automatically and randomly defined.</p>
<p><strong>2 | Outer Leave-Group Out/Inner pooled</strong>
The outer CV2 folds will be defined by the user using a vector defining groups (e.g., if there are different sites then this will test the ability of the classifiers that are trained with pooled site data to generalise to new sites).</p>
<p><strong>3 | Nested Leave-Group-Out</strong>
Both the outer and inner cycles will be separated based on the grouping vector that the user enters (e.g., in the site example, this will mean that the models will be optimised to generalise across sites in the CV1 cycle and then applied to different sites in the CV2 cycle).</p>
<p><strong>4 | Outer Leave-Group-Out/Inner Leave-Group-In</strong>
The models in the inner CV1 cycle will only be trained in one group prior to being applied to all other groups (e.g., this will test the robustness of models from single sites). See <a class="reference internal" href="#fig-3-2-01-nested-cv"><span class="std std-numref">Fig. 8</span></a> for more details and imagine that the folds are sites or diagnoses or any other grouping variable.</p>
</div>
</section>
<section id="repeated-cross-valiation">
<h3>Repeated cross-valiation<a class="headerlink" href="#repeated-cross-valiation" title="Permalink to this headline">#</a></h3>
<p>To further avoid overfitting and increase the generalizability of the model predictions, NeuroMiner also allows the user to implement ’repeated’ cross-validation for each of the CV cycles. This involves shuffling the subjects prior to the definition of the folds so that there are different subjects in the test/training folds. This is usually done for both the CV2 and CV1 cycles.</p>
<p>A clear depiction of how repeated cross-validation works is difficult, but it is important to keep in-mind that there will be a lot of models produced under these schemes; e.g., if you have a standard 10x10 CV1/CV2 framework and you’re choosing the optimal model for each fold, then you’ll have 10,000 models. A way to understand how these are applied to an individual subject is to consider that all models in which that subject is not included in the CV1 training/testing are applied to them–because if they were included then this would be information leakage. On the surface, having 10,000 models is not so great for the interpretation or understanding of a phenomena under investigation. However, doing this can be really good for generalization when it’s unlikely that there is a singular model that can be found and we need something that practically works–e.g., for many complex problems in psychiatry. For an interesting discussion on this topic, see <a class="reference external" href="http://www.stat.uchicago.edu/~lekheng/courses/191f09/breiman.pdf">Breiman et al., 2001</a>.</p>
</section>
<hr class="docutils" />
<section id="define-the-number-pf-folds-permutations-in-cv1-cv2">
<h3>Define the number pf folds &amp; permutations in CV1 &amp; CV2<a class="headerlink" href="#define-the-number-pf-folds-permutations-in-cv1-cv2" title="Permalink to this headline">#</a></h3>
<p>In the cross-validation menu (<code class="xref std std-numref docutils literal notranslate"><span class="pre">fig:3.2.01_cv_menu</span></code>) you can define the number of permutations (“repeats”) and folds for CV1 and CV2 respectively using the options 2 to 5 (note that these might change depending on the cross-validation framework you choose!).</p>
<section id="choosing-the-number-of-permutations">
<h4>Choosing the number of permutations<a class="headerlink" href="#choosing-the-number-of-permutations" title="Permalink to this headline">#</a></h4>
<p>If you choose to use repeated cross-validation, the subjects are shuffled and new folds are created. To choose the number of permutations, try to find a balance between the computational time that your analysis is taking and the stability of the predictions from your modeling.</p>
</section>
</section>
<section id="choosing-the-number-of-folds">
<h3>Choosing the number of folds<a class="headerlink" href="#choosing-the-number-of-folds" title="Permalink to this headline">#</a></h3>
<p>The number of folds is usually based on the number of subjects you have and what kind of analyses you want to compute.</p>
<p>For an analytic example of when the number of CV1 folds is crucial for the outcome see the section on [ensemble generation strategies]{3.2.05_paramtemp_ensemble_generation_strategies} – e.g., when using wrappers that are optimizing features based on the subjects in the CV1 test folds.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you enter “-1” as the number of CV1 or CV2 folds, then NeuroMiner implements a <strong>leave-one-out cross-validation</strong> and the permutations option is not possible (because it doesn’t matter if you shuffle the data if every single subject is left out). The number of CV folds is usually based on the number of subjects that you have.</p>
</div>
</section>
<hr class="docutils" />
<section id="equalize-class-sizes-at-the-cv1-cycle-by-undersampling">
<h3>Equalize class sizes at the CV1 cycle by undersampling<a class="headerlink" href="#equalize-class-sizes-at-the-cv1-cycle-by-undersampling" title="Permalink to this headline">#</a></h3>
<p>Unbalanced group sizes (e.g., less people transitioning to illness than people who do not) pose a problem for support vector machines and other analysis techniques. Usually, the trained model shows a bias towards the majority group and you’ll get unbalanced predictions (e.g., your specificity will be high, but sensitivity low).</p>
<p>In NeuroMiner there are three ways to deal with this:</p>
<ol class="simple">
<li><p>undersampling the majority group during training</p></li>
<li><p>weighting the SVM hyperplane</p></li>
<li><p>Oversampling using “Adaptive synthetic sampling”</p></li>
</ol>
<p>If you enable udnersampling by choosing one of these approaches, the majority group will be undersampled to balance the groups in the CV1 folds.</p>
<p>After selecting the undersampling option (by entering “6” if your menu looks like in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig:3.2.01_cv_menu</span></code>, the corresponding number can change though depending on chosen settings), two new lines will be added to your menu:</p>
<figure class="align-default" id="fig-nm-cv-menu-equalize">
<img alt="Neurominer cross-validation equalize classes screenshot" src="../_images/NM_cv_menu_equalize.png" />
</figure>
<!-- you will be prompted with will be prompted with this: ”Enable class size balancing at the CV1 level”, and enabling this option will lead to a prompt: ”Perform histogram equalization using the target label or some other covariate”, you can choose depending on which parameter you want to undersampling your algorithm.  -->
<p><strong>7 | Define positive/negative ratio after equalization (1=&gt;same amount of positive/negative cases)</strong>: This is the ratio of the bigger to smaller class sample sizes. Equal class sizes can be selected by entering in ”1”. The default is “1.5” because otherwise the models may not generalize well.</p>
<!-- If the dataset has any covariates, selecting ”Covariate” option will require you to select the covariates (integers or range). -->
<p><strong>8 | Shuffle removed observations to CV1 test data</strong>: The next option gives the user the option to add the excluded CV1 subjects in the training folds to the CV1 test folds. This option is potentially important for potential generalizability of the models to the CV2 folds (and ultimately to real-life).</p>
</section>
</section>
<hr class="docutils" />
<section id="build-load-save-the-cross-validation-structure">
<h2>Build, load &amp; save the cross-validation structure<a class="headerlink" href="#build-load-save-the-cross-validation-structure" title="Permalink to this headline">#</a></h2>
<p><strong>Build CV2/CV1 structure</strong>
Once the options have been selected above, then the user needs to build the CV2/CV1 structure. This literally creates all the folds and indexes the subjects that are to be included in the folds. These can be found in the NM structure (i.e., in “<a class="reference external" href="http://NM.cv">NM.cv</a>”).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The user must select <strong>Build the cross-validation structure</strong> before
exiting the cross-validation menu. Otherwise, the cross-validation framework will not be saved
within the NM structure.</p>
</div>
<p><strong>Load CV structure</strong>
If you have saved the CV structure for your data with the subjects indexed into each fold/permutation, you can load it using this function. This can be useful if you establish a new analysis with new settings, but you want to load the CV structure that you made before.</p>
<p><strong>Save CV structure</strong>
This gives the user the option to save the indexed CV structure
containing the folds and permutations for later use. It is saved in a .mat file.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="3.2.00_paramtemp_data_fusion.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data Fusion</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="3.2.02_paramtemp_preprocessing_pipeline.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Preprocessing pipeline</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Neurodiagnostics Lab LMU Munich<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>